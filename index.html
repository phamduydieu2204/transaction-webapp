<!DOCTYPE html>
<html>
<head>
  <title>Quản lý giao dịch</title>
  <style>
    table { border-collapse: collapse; width: 100%; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    th { background-color: #f2f2f2; }
  </style>
</head>
<body>
  <h2>Nhập giao dịch</h2>
  <form id="transactionForm">
    <input type="text" id="transactionId" placeholder="Mã giao dịch (tự sinh)" readonly>
    <input type="text" id="customerName" placeholder="Tên khách hàng" required>
    <input type="email" id="email" placeholder="Email" required>
    <input type="text" id="contact" placeholder="Liên hệ" required>
    <input type="number" id="months" placeholder="Số tháng đăng ký" required>
    <input type="date" id="startDate" placeholder="Ngày bắt đầu">
    <input type="number" id="deviceCount" placeholder="Số thiết bị" required>
    <select id="software" onchange="updatePackages()">
      <option value="">Chọn phần mềm</option>
      <option value="helium10">Helium10</option>
      <option value="capcut">Capcut</option>
      <option value="canva">Canva</option>
      <option value="chatgpt">Chatgpt</option>
    </select>
    <select id="package">
      <option value="">Chọn gói</option>
    </select>
    <input type="number" id="revenue" placeholder="Doanh thu" required>
    <input type="text" id="note" placeholder="Ghi chú">
    <input type="text" id="staffId" placeholder="Mã nhân viên" required>
    <button type="submit">Nhập dữ liệu</button>
    <button type="button" onclick="searchData()">Tìm kiếm</button>
  </form>

  <h2>Kết quả tìm kiếm</h2>
  <table id="resultTable">
    <thead>
      <tr>
        <th>Mã GD</th><th>Ngày giờ</th><th>Tên KH</th><th>Email</th><th>Liên hệ</th>
        <th>Số tháng</th><th>Ngày bắt đầu</th><th>Ngày kết thúc</th><th>Số thiết bị</th>
        <th>Phần mềm</th><th>Gói</th><th>Doanh thu</th><th>Ghi chú</th><th>Người nhập</th>
      </tr>
    </thead>
    <tbody id="tableBody"></tbody>
  </table>

  <script>
    const scriptURL = "https://script.google.com/macros/s/AKfycbyzpfzwZ1nSzP7XU4weJ_Os7ncKO3A1sF64egLEaL6GDSyHbQqpgXb-0afUrmIazABuxA/exec"; // Thay bằng URL từ Apps Script
    const packageOptions = {
      helium10: ["Diamon", "Platinum"],
      capcut: ["Edut", "Business"],
      canva: [],
      chatgpt: ["Share 2", "Share 3"]
    };

    // Cập nhật dropdown gói phần mềm
    function updatePackages() {
      const software = document.getElementById("software").value;
      const packageSelect = document.getElementById("package");
      packageSelect.innerHTML = '<option value="">Chọn gói</option>';
      if (packageOptions[software]) {
        packageOptions[software].forEach(pkg => {
          const option = document.createElement("option");
          option.value = pkg;
          option.textContent = pkg;
          packageSelect.appendChild(option);
        });
      }
    }

    // Gửi dữ liệu
    document.getElementById("transactionForm").addEventListener("submit", function(e) {
      e.preventDefault();
      const data = {
        action: "add",
        customerName: document.getElementById("customerName").value,
        email: document.getElementById("email").value,
        contact: document.getElementById("contact").value,
        months: document.getElementById("months").value,
        startDate: document.getElementById("startDate").value,
        deviceCount: document.getElementById("deviceCount").value,
        software: document.getElementById("software").value,
        package: document.getElementById("package").value,
        revenue: document.getElementById("revenue").value,
        note: document.getElementById("note").value,
        staffId: document.getElementById("staffId").value
      };
      fetch(scriptURL, {
        method: "POST",
        body: JSON.stringify(data)
      }).then(() => {
        alert("Đã thêm giao dịch!");
        this.reset();
        searchData();
      });
    });

    // Tìm kiếm dữ liệu
    function searchData() {
      const params = new URLSearchParams({
        transactionId: document.getElementById("transactionId").value,
        customerName: document.getElementById("customerName").value,
        email: document.getElementById("email").value,
        software: document.getElementById("software").value
      });
      fetch(`${scriptURL}?${params}`)
        .then(response => response.json())
        .then(data => {
          const tbody = document.getElementById("tableBody");
          tbody.innerHTML = "";
          data.forEach(row => {
            const tr = document.createElement("tr");
            row.slice(0, -1).forEach(cell => { // Bỏ cột Mã nhân viên
              const td = document.createElement("td");
              td.textContent = cell;
              tr.appendChild(td);
            });
            tbody.appendChild(tr);
          });
        });
    }
  </script>
</body>
</html>